# 基金管家 - 消息推送配置指南

本文档详细说明如何配置各种消息推送服务，让您能够及时收到基金收益报告。

---

## 📱 企业微信配置

### 第一步：创建群聊机器人

1. **打开企业微信**，创建一个群聊（如果没有的话）

2. **进入群聊**，点击右上角的 **"群机器人"** 图标

3. 选择 **"添加机器人"** 

4. 给机器人起个名字，比如：`基金管家`

5. 点击 **"添加"**，系统会生成一个 Webhook 地址

6. **复制完整的 Webhook 地址**

### 第二步：配置到项目中

有两种方式配置：

#### 方式1：创建 `.env` 文件（推荐）

在项目根目录创建 `.env` 文件，添加以下内容：

```env
WECHAT_WEBHOOK=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=你的key
```

**注意**：`.env` 文件中的 key 需要替换为你实际获取的 key。

#### 方式2：直接在 config.py 中配置

如果不想使用 `.env` 文件，可以直接在 `config.py` 中修改：

```python
# 企业微信配置
WECHAT_WEBHOOK = "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=你的key"
```

### 第三步：测试配置

运行测试脚本，检查是否能正常发送：

```bash
py main.py
# 选择选项 1：立即运行一次
```

如果配置成功，你应该能在企业微信群中收到消息。

---

## 📱 Server酱配置（微信推送到个人）

### 第一步：注册获取 KEY

1. 访问 [Server酱官网](http://sc.ftqq.com/3.version)

2. 使用 **GitHub 账号** 登录

3. 进入"发送消息"页面，获取 **SCKEY**

### 第二步：配置到项目

在 `.env` 文件中添加：

```env
SERVER_CHAN_KEY=你的server酱key
```

或直接在 `config.py` 中修改：

```python
SERVER_CHAN_KEY = "你的server酱key"
```

---

## 📱 钉钉配置

### 第一步：创建群机器人

1. 打开 **钉钉**，创建一个群聊

2. 点击 **群设置** -> **智能群助手** -> **添加机器人** -> **自定义**

3. 给机器人起名字和头像

4. 在 **安全设置** 中选择 **"加签"**

5. 复制 **Webhook 地址** 和 **加签密钥**

### 第二步：配置到项目

在 `.env` 文件中添加：

```env
DINGTALK_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=你的token
```

---

## 🚀 快速开始

### 1. 创建 `.env` 文件

在项目根目录创建 `.env` 文件（Windows 用户可以通过以下命令）：

```powershell
# PowerShell
New-Item -ItemType File -Name ".env"
```

```bash
# CMD
type nul > .env
```

### 2. 编辑 `.env` 文件

添加你的配置：

```env
# 企业微信（推荐）
WECHAT_WEBHOOK=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxxxxx

# Server酱（可选）
SERVER_CHAN_KEY=your_key

# 钉钉（可选）
DINGTALK_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxx
```

### 3. 测试推送

```bash
py main.py
# 选择选项 1
```

---

## 📝 配置示例

完整的 `.env` 文件示例：

```env
# 企业微信配置
WECHAT_WEBHOOK=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=693axxx6b7-4c03-4xxx-a9d2-xxxxxxx

# Server酱配置（可选）
SERVER_CHAN_KEY=SCT123456TuiKan123abc

# 钉钉配置（可选）
DINGTALK_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=abc123def456
```

---

## ❓ 常见问题

### Q: 收到"未配置企业微信webhook"提示？

**A:** 检查以下几点：
1. 是否创建了 `.env` 文件？
2. `.env` 文件是否在项目根目录？
3. 配置项名称是否正确（`WECHAT_WEBHOOK`）？
4. 配置值是否完整（包含完整的 URL 和 key）？

### Q: 配置后仍收不到消息？

**A:** 按以下步骤排查：
1. 运行测试脚本：`py test.py`
2. 检查日志文件：`fund_manager.log`
3. 确认 Webhook 地址正确
4. 确认企业微信群机器人未失效

### Q: 可以同时使用多个推送方式吗？

**A:** 可以！系统会同时尝试所有已配置的推送方式。你可以同时配置企业微信、Server酱和钉钉，确保消息能送达。

### Q: Webhook 地址会过期吗？

**A:** 企业微信和钉钉的 Webhook 地址在机器人未被删除的情况下不会过期。如果机器人被删除，需要重新创建并更新配置。

---

## 🔒 安全提示

⚠️ **重要**：`.env` 文件包含敏感信息，请勿上传到 GitHub 等公共代码仓库。

项目已配置 `.gitignore`，会自动忽略 `.env` 文件。

---

## 📞 更多帮助

如有问题，请查看：
- 主文档：`README.md`
- 使用说明：`使用说明.md`
- 日志文件：`fund_manager.log`
