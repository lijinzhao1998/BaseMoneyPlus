# 更新日志

## v2.1 - 2024-10-30

### 🎉 新增功能

#### 1. 配置文件管理工具

新增 `config_manager.py`，提供完整的基金配置管理功能：

**功能清单**：
- ✅ 查看所有基金配置
- ✅ 添加持仓基金
- ✅ 添加观察基金
- ✅ 删除基金
- ✅ 更新基金信息
- ✅ 观察基金转持仓
- ✅ 持仓基金转观察
- ✅ 自动备份配置文件

**使用方法**：
```bash
# 方式1：运行批处理脚本（Windows）
双击 run_config_manager.bat

# 方式2：命令行运行
py config_manager.py
```

**示例操作**：
```
1. 查看所有基金 - 显示当前持仓和观察列表
2. 添加持仓基金 - 添加新的投资基金
3. 添加观察基金 - 添加想要跟踪的基金
4. 删除基金 - 从配置中移除基金
5. 更新基金信息 - 修改已有基金的信息
6. 观察基金转持仓 - 将观察的基金转为实际持仓
7. 持仓基金转观察 - 卖出后转为观察状态
```

#### 2. 增强的数据获取能力

优化了历史数据获取，提供多个API备用方案：

**改进内容**：
- ✅ 多个API接口自动切换
- ✅ 详细的错误提示
- ✅ 更长的超时时间（15秒）
- ✅ 实时显示获取进度

**API接口列表**：
1. 东方财富API接口1（主要）
2. 东方财富API接口2（备用）
3. 天天基金网接口（备用）

**效果对比**：
```
# 旧版本
❌ 基金1 (017811): 无法获取历史数据

# 新版本
正在分析基金 017811 基金1...
  尝试API接口 1/3... ❌ 失败: Connection timeout
  尝试API接口 2/3... ✅ 成功 (获取 120 条数据)
```

#### 3. 多格式报告生成

新增 `report_generator.py`，支持导出多种格式的分析报告：

**支持格式**：
- ✅ **TXT格式** - 纯文本，易于阅读和打印
- ✅ **HTML格式** - 精美网页，带样式和图标（推荐）
- ✅ **Markdown格式** - 适合GitHub和文档系统
- ✅ **JSON格式** - 原始数据，便于程序处理

**HTML报告特色**：
- 🎨 现代化渐变背景设计
- 📊 清晰的数据表格展示
- 🎯 操作建议分类高亮
- 📈 偏离度颜色标识（红色/绿色）
- 💫 悬停动画效果
- 📱 响应式设计，支持移动端

**使用方法**：
```python
from report_generator import ReportGenerator

generator = ReportGenerator()

# 生成HTML报告（推荐）
html_file = generator.generate_html_report(analysis_results)

# 生成TXT报告
txt_file = generator.generate_txt_report(analysis_results)

# 生成Markdown报告
md_file = generator.generate_markdown_report(analysis_results)
```

**报告示例**：

在 `ma_analysis.py` 分析完成后：
```
是否保存分析报告到文件?
1. TXT格式 (文本文件)
2. HTML格式 (网页文件，推荐)
3. Markdown格式 (适合GitHub)
4. JSON格式 (原始数据)
5. 全部格式
0. 不保存

请选择 (0-5): 2

✅ HTML报告已保存: reports/fund_analysis_report_20241030_153020.html
```

### 🔧 优化改进

#### 1. 更好的错误处理

- API调用失败时自动尝试其他接口
- 显示详细的错误信息
- 区分不同类型的错误（网络、数据、超时等）

#### 2. 报告目录管理

- 所有报告统一保存在 `reports` 目录
- 自动创建目录
- 文件名包含时间戳，避免覆盖

#### 3. 配置文件备份

- 修改配置前自动备份
- 备份文件：`holdings_config.json.backup`
- 保护数据安全

### 📁 新增文件

```
BaseMoneyPlus/
├── config_manager.py           # 配置管理工具
├── report_generator.py         # 报告生成器
├── run_config_manager.bat      # Windows快捷启动
├── reports/                    # 报告目录（自动创建）
│   ├── *.html                  # HTML报告
│   ├── *.txt                   # TXT报告
│   ├── *.md                    # Markdown报告
│   └── *.json                  # JSON数据
└── 更新日志.md                 # 本文件
```

### 🎯 使用场景

#### 场景1：管理基金配置

```bash
1. 运行 run_config_manager.bat
2. 选择"添加持仓基金"
3. 输入基金信息
4. 配置自动保存并备份
```

#### 场景2：生成分析报告

```bash
1. 运行 run_ma_analysis.bat
2. 选择"分析配置文件中的所有基金"
3. 等待分析完成
4. 选择报告格式（推荐HTML）
5. 在浏览器中打开HTML报告
```

#### 场景3：修改已有配置

```bash
1. 运行配置管理工具
2. 选择"更新基金信息"
3. 输入要修改的基金代码
4. 输入新的值（留空保持不变）
5. 确认保存
```

#### 场景4：观察基金转持仓

```bash
# 当观察的基金到达合适买入点
1. 运行配置管理工具
2. 选择"观察基金转持仓"
3. 输入基金代码
4. 输入实际买入信息
5. 基金自动转为持仓状态
```

### 📊 报告对比

#### TXT报告（简洁）
```
============================================================
基金均线分析报告
============================================================

【操作建议汇总】

⭐⭐⭐ 强烈建议加仓:
  • 招商中证白酒 (161725)

【详细分析】

基金: 招商中证白酒 (161725)
当前净值: 0.8234
...
```

#### HTML报告（精美）
- 渐变背景设计
- 卡片式布局
- 彩色标签
- 数据表格
- 悬停效果
- 响应式设计

#### Markdown报告（适合文档）
```markdown
# 基金均线分析报告

**生成时间**: 2024-10-30 15:30:20
**分析基金数量**: 5

---

## 📊 操作建议汇总

### ⭐⭐⭐ 强烈建议加仓

- **招商中证白酒** (`161725`)
```

### ⚠️ 重要说明

#### 1. 配置文件备份

每次修改配置时，系统会自动创建备份：
- 备份文件：`holdings_config.json.backup`
- 如需恢复：删除当前配置，将备份改名即可

#### 2. API接口限制

为避免请求过快被限制：
- 分析多个基金时，间隔1秒
- 失败后会自动尝试备用接口
- 建议交易日晚上运行（数据更新）

#### 3. 报告文件管理

- 报告保存在 `reports` 目录
- 文件名包含时间戳
- 定期清理旧报告，避免占用空间

#### 4. HTML报告查看

- 双击HTML文件即可在浏览器打开
- 支持Chrome、Edge、Firefox等主流浏览器
- 可打印或转为PDF保存

### 🚀 后续计划

可能的未来更新：
- [ ] 图表可视化（均线走势图）
- [ ] 邮件发送报告
- [ ] 微信推送功能
- [ ] 定时自动分析
- [ ] 更多技术指标（MACD、RSI等）
- [ ] 历史回测功能
- [ ] Web管理界面

### 💡 使用技巧

#### 技巧1：快速查看HTML报告

创建批处理脚本 `open_latest_report.bat`：
```batch
@echo off
cd reports
for /f "delims=" %%i in ('dir *.html /b /o-d') do (
    start "" "%%i"
    goto :end
)
:end
```

#### 技巧2：批量添加基金

编辑 `holdings_config.json`，直接添加多个基金配置，比使用工具更快。

#### 技巧3：定期分析

创建Windows计划任务，每晚自动运行分析并生成报告。

#### 技巧4：对比分析

保存每次的报告，对比不同时间的分析结果，观察趋势变化。

### 📚 相关文档

- [README.md](README.md) - 项目总览
- [使用说明.md](使用说明.md) - 详细使用指南
- [均线分析说明.md](均线分析说明.md) - 均线分析详解
- [均线分析快速开始.md](均线分析快速开始.md) - 5分钟上手
- [功能更新说明.md](功能更新说明.md) - v2.0功能说明

---

**投资有风险，决策需谨慎！本系统仅供学习和参考使用。**

