# 基金均线分析系统说明

## 📊 系统概述

基金均线分析系统是一个智能投资辅助工具，通过分析基金的多周期均线（月线、季线、年线、长期均线），帮助投资者判断当前基金所处的位置，并给出买入、持有或卖出的建议。

## 🎯 核心功能

### 1. 多周期均线计算

| 均线类型 | 周期 | 作用 |
|---------|------|------|
| MA20 (月线) | 20个交易日 | 反映短期趋势 |
| MA60 (季线) | 60个交易日 | 反映中期趋势 |
| MA250 (年线) | 250个交易日 | 反映长期趋势 |
| MA500 (长期) | 500个交易日 | 反映历史位置 |

### 2. 偏离度分析

计算当前净值与各均线的偏离程度：

- **偏离度** = (当前净值 - 均线值) / 均线值 × 100%
- **正偏离**：当前价格高于均线，可能高估
- **负偏离**：当前价格低于均线，可能低估

### 3. 智能操作建议

系统根据各均线偏离度综合评分，给出操作建议：

#### 评分规则

| 偏离情况 | 月线权重 | 季线权重 | 年线权重 | 长期权重 |
|---------|---------|---------|---------|---------|
| 超跌（-20%以下） | - | - | +4 | +3 |
| 偏低（-10%~-20%） | +2 | +3 | +3 | +2 |
| 略低（-5%~-10%） | +1 | +2 | - | - |
| 合理（-5%~+5%） | 0 | 0 | 0 | 0 |
| 略高（+5%~+10%） | -1 | -2 | - | - |
| 偏高（+10%~+20%） | -2 | -3 | -3 | -2 |
| 超涨（+20%以上） | - | - | -4 | -3 |

#### 操作建议

| 总分 | 建议 | 说明 |
|------|------|------|
| +3~+5 | ⭐⭐⭐ 强烈建议加仓 | 基金处于历史低位 |
| +1~+2 | ⭐⭐ 可以适当加仓 | 基金相对低估 |
| -1~+1 | ⭐ 持有观望 | 基金处于合理区间 |
| -3~-2 | ⚠️⚠️ 可以适当减仓 | 基金相对高估 |
| -5~-4 | ⚠️⚠️⚠️ 建议减仓 | 基金处于历史高位 |

### 4. 精确收益计算

**为什么需要设置投入日期？**

❌ **错误做法**：从基金成立日期计算收益
```
基金成立: 2020-01-01, 净值 1.0000
实际投入: 2024-01-01, 净值 1.5000
当前净值: 1.6000

错误计算: (1.6000 - 1.0000) / 1.0000 = +60%  ← 错误！
```

✅ **正确做法**：从实际投入日期计算收益
```
实际投入: 2024-01-01, 净值 1.5000
当前净值: 1.6000

正确计算: (1.6000 - 1.5000) / 1.5000 = +6.67%  ← 正确！
```

## 📝 配置文件说明

### holdings_config.json 结构

```json
{
  "holdings": {
    // 持仓基金配置
  },
  "watchlist": {
    // 观察基金配置
  }
}
```

### 持仓基金配置 (holdings)

```json
"017811": {
  "name": "基金1",                          // 基金名称
  "cost_basis": 1.0,                       // 成本净值
  "amount": 10000,                         // 投资金额（元）
  "invested": true,                        // 是否已投入
  "investment_start_date": "2024-01-01"    // 投入日期（重要！）
}
```

**字段说明：**

- `name`: 基金名称，便于识别
- `cost_basis`: 您买入时的净值
- `amount`: 投资金额（元）
- `invested`: 必须为 `true`
- `investment_start_date`: **重要！** 实际投入日期，用于计算真实收益

### 观察基金配置 (watchlist)

```json
"161725": {
  "name": "招商中证白酒",                    // 基金名称
  "invested": false,                        // 未投入
  "watch_start_date": "2024-01-01",        // 开始观察日期
  "note": "观察是否到达低点"                 // 备注
}
```

**字段说明：**

- `name`: 基金名称
- `invested`: 必须为 `false`，表示仅观察
- `watch_start_date`: 开始观察的日期（用于计算假设收益）
- `note`: 备注信息，记录观察原因

## 🚀 使用指南

### 方法1：独立运行均线分析

```bash
py ma_analysis.py
```

**功能：**
1. 分析配置文件中的所有基金（持仓+观察）
2. 分析单只基金（手动输入代码）
3. 生成完整分析报告
4. 汇总操作建议

**适用场景：**
- 想单独进行均线分析
- 需要详细的技术分析报告
- 准备加仓或减仓前的决策参考

### 方法2：集成在日报中

```bash
py main.py
```

选择"立即运行一次"

**功能：**
- 生成完整的基金日报
- 包含收益分析 + 均线分析
- 发送到配置的消息渠道

**适用场景：**
- 每日例行查看基金情况
- 需要完整的收益+技术分析

## 📈 实战案例

### 案例1：判断加仓时机

**背景：** 某白酒基金近期大跌

```
============================================================
📊 招商中证白酒 (161725)
============================================================

💰 当前净值: 0.8234

📈 均线分析:
  月线(MA20):  0.8567   偏离:  -3.89%
  季线(MA60):  0.9123   偏离:  -9.74%
  年线(MA250): 1.0234   偏离: -19.55%
  长期(MA500): 1.1456   偏离: -28.12%

🎯 位置分析:
  当前位置: low
  信号强度: 4/5
  操作建议: ⭐⭐⭐ 强烈建议加仓

  详细分析:
    • 月线下方3.89% - 短期偏低
    • 季线下方9.74% - 中期偏低  
    • 年线下方19.55% - 长期偏低
    • 长期均线下方28.12% - 历史低位
```

**分析：**
- ✅ 所有均线均处于负偏离状态
- ✅ 年线和长期均线偏离度很大（-19.55%, -28.12%）
- ✅ 评分 4/5，接近历史低位
- 💡 **建议：可以考虑加仓**

### 案例2：观察未投入基金

**背景：** 想买一只科技基金，但不确定时机

**配置：**
```json
"watchlist": {
  "110011": {
    "name": "易方达中小盘",
    "invested": false,
    "watch_start_date": "2024-06-01",
    "note": "等待回调到年线附近"
  }
}
```

**分析结果：**
```
============================================================
📊 易方达中小盘 (110011)
============================================================

💰 当前净值: 7.8234

📈 均线分析:
  月线(MA20):  7.6567   偏离:  +2.18%
  季线(MA60):  7.5123   偏离:  +4.14%
  年线(MA250): 7.2234   偏离:  +8.31%
  长期(MA500): 6.8456   偏离: +14.28%

🎯 位置分析:
  当前位置: medium_high
  信号强度: -2/5
  操作建议: ⚠️⚠️ 可以适当减仓
```

**分析：**
- ❌ 所有均线均处于正偏离状态
- ❌ 价格高于年线 8.31%，高于长期均线 14.28%
- ❌ 评分 -2/5，相对高位
- 💡 **建议：暂不买入，继续观察**

### 案例3：设置投入日期的重要性

**场景A：未设置投入日期**
```json
{
  "name": "某基金",
  "cost_basis": 1.2,
  "amount": 10000,
  "invested": true
  // 未设置 investment_start_date
}
```

系统只能从 cost_basis 计算收益，无法知道实际投入时间点。

**场景B：设置投入日期**
```json
{
  "name": "某基金",
  "cost_basis": 1.2,
  "amount": 10000,
  "invested": true,
  "investment_start_date": "2024-03-15"
}
```

系统会：
1. 获取 2024-03-15 当天的实际净值（例如 1.1956）
2. 用当前净值与实际投入日净值计算收益
3. 更准确地反映您的投资表现

**收益对比：**
```
# 不设投入日期（从 cost_basis 计算）
投入成本: 1.2000
当前净值: 1.3000
收益率: +8.33%

# 设置投入日期（从实际日期计算）
投入日期: 2024-03-15
投入日净值: 1.1956
当前净值: 1.3000
收益率: +8.73%  ← 更准确！
```

## ⚠️ 注意事项

### 1. 投资建议仅供参考

- 均线分析是技术分析的一种方法
- 不能作为唯一的投资依据
- 需要结合基本面、市场环境等因素
- 投资有风险，决策需谨慎

### 2. 数据更新时间

- 基金净值通常在交易日 18:00-22:00 更新
- 节假日不更新
- 建议在交易日晚上查看分析结果

### 3. 历史数据要求

- 月线分析至少需要 20 天数据
- 季线分析至少需要 60 天数据
- 年线分析至少需要 250 天数据
- 长期均线至少需要 500 天数据
- 新基金可能无法进行全部分析

### 4. 配置文件建议

- **必须设置** `investment_start_date`，否则收益计算不准确
- 定期更新配置文件，反映实际持仓变化
- 观察基金达到买入条件后，及时移动到 holdings

## 🔧 技术原理

### 均线计算公式

```
MA(n) = (P1 + P2 + ... + Pn) / n
```

其中：
- P1, P2, ..., Pn 为最近 n 天的净值
- n 为均线周期

### 偏离度计算公式

```
偏离度 = (当前净值 - 均线值) / 均线值 × 100%
```

### 信号强度计算

```python
总分 = 月线得分 + 季线得分 + 年线得分 + 长期得分

# 月线得分规则
if 偏离 < -10%: 得分 +2
elif 偏离 < -5%: 得分 +1
elif 偏离 > 10%: 得分 -2
elif 偏离 > 5%: 得分 -1

# 季线得分规则
if 偏离 < -15%: 得分 +3
elif 偏离 < -8%: 得分 +2
elif 偏离 > 15%: 得分 -3
elif 偏离 > 8%: 得分 -2

# 年线得分规则
if 偏离 < -20%: 得分 +4
elif 偏离 < -10%: 得分 +3
elif 偏离 > 20%: 得分 -4
elif 偏离 > 10%: 得分 -3

# 长期得分规则
if 偏离 < -25%: 得分 +3
elif 偏离 < -15%: 得分 +2
elif 偏离 > 25%: 得分 -3
elif 偏离 > 15%: 得分 -2
```

## 📚 更多资源

- **使用说明**：`使用说明.md`
- **配置指南**：`配置指南.md`
- **部署指南**：`部署指南.md`

## ❓ 常见问题

**Q: 为什么我的基金没有长期均线？**
A: 基金成立时间不足 500 天，无法计算长期均线。这种情况下只参考其他均线。

**Q: 投入日期一定要填吗？**
A: 强烈建议填写！否则系统只能用 cost_basis 计算收益，不够准确。

**Q: 观察基金会影响持仓计算吗？**
A: 不会。观察基金只做分析，不计入总资产和总收益。

**Q: 如何判断系统建议是否可靠？**
A: 建议只是参考，需要结合：
- 基金的基本面（管理人、持仓股票等）
- 市场整体环境
- 个人风险承受能力
- 投资目标和期限

**Q: 多久运行一次分析合适？**
A: 建议：
- 日常：每天运行一次，关注持仓变化
- 决策：准备买卖前仔细分析
- 观察：每周检查观察列表

## 📞 技术支持

如有问题或建议，欢迎反馈！

