# 服务器部署指南

## 服务器信息
- **IP地址**: your_server_ip
- **用户名**: your_username
- **密码**: your_password
- **部署路径**: /opt/fund_manager

## 部署步骤

### 方法1: 使用 WinSCP (Windows推荐)

1. **下载安装 WinSCP**
   - 访问: https://winscp.net/eng/download.php
   - 下载并安装

2. **连接到服务器**
   - 打开 WinSCP
   - 主机名: `your_server_ip`
   - 用户名: `your_username`
   - 密码: `your_password`
   - 点击"登录"

3. **上传项目文件**
   - 双击进入 `/opt` 目录
   - 如果没有 `fund_manager` 文件夹，创建它
   - 打开项目目录（deploy_temp 文件夹）
   - 将所有 `.py` 文件、`requirements.txt`、`holdings_config.json`、`.env.example` 等文件拖拽到服务器

4. **在服务器上执行命令**
   ```bash
   # 连接到服务器
   ssh username@your_server_ip
   
   # 进入项目目录
   cd /opt/fund_manager
   
   # 安装依赖
   pip3 install -r requirements.txt
   
   # 创建环境变量文件（方式一：手动创建）
   cp .env.example .env
   vi .env
   # 编辑 .env 文件，填入您的实际配置
   
   # 或方式二：命令行创建
   # echo "SERVER_CHAN_KEY=your_actual_key_here" > .env
   
   保存并退出（按 ESC，输入 `:wq`）

5. **启动守护进程**
   ```bash
   python3 daemon.py start
   ```

6. **查看状态**
   ```bash
   python3 daemon.py status
   ```

### 方法2: 使用命令行 SCP

如果你已经配置了 SSH 密钥：

```bash
# 在 Windows PowerShell 中
   scp -r * username@your_server_ip:/opt/fund_manager/
```

## 后台运行管理

### 启动守护进程
```bash
cd /opt/fund_manager
python3 daemon.py start
```

### 停止守护进程
```bash
python3 daemon.py stop
```

### 重启守护进程
```bash
python3 daemon.py restart
```

### 查看守护进程状态
```bash
python3 daemon.py status
```

## 配置定时任务

守护进程启动后，会自动在每天的指定时间（config.py 中配置的 SCHEDULE_TIME）运行并发送报告。

## 查看日志

```bash
# 实时查看日志
tail -f /opt/fund_manager/fund_manager.log

# 查看最近100行日志
tail -n 100 /opt/fund_manager/fund_manager.log
```

## 故障排查

### 如果守护进程无法启动

1. 检查Python版本
   ```bash
   python3 --version
   ```
   需要 Python 3.7 或更高版本

2. 检查依赖是否安装完整
   ```bash
   pip3 list
   ```

3. 查看错误日志
   ```bash
   cat /opt/fund_manager/fund_manager.log
   ```

### 如果报告无法发送

1. 检查环境变量配置
   ```bash
   cat /opt/fund_manager/.env
   ```

2. 测试网络连接
   ```bash
   curl -X POST https://sctapi.ftqq.com/YOUR_KEY_HERE.send
   ```

## 安全建议

1. **更改默认密码**（生产环境强烈建议）
2. **使用SSH密钥**代替密码登录
3. **配置防火墙**，只允许必要的端口
4. **定期备份**配置和日志文件

## 联系支持

如有问题，请查看：
- README.md
- 使用说明.md
- DAEMON.md